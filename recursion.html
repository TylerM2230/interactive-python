<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learn Recursion</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Custom styles (consistent with previous tutorials) */
      body {
        font-family: "Inter", sans-serif;
      }
      pre {
        background-color: #f3f4f6; /* gray-100 */
        border: 1px solid #e5e7eb; /* gray-200 */
        border-radius: 0.375rem; /* rounded-md */
        padding: 1rem; /* p-4 */
        overflow-x: auto;
        font-family: monospace;
        font-size: 0.875rem; /* text-sm */
        margin-top: 0.5rem; /* mt-2 */
        margin-bottom: 1rem; /* mb-4 */
        position: relative;
      }
      code {
        font-family: monospace;
        background-color: rgba(209, 213, 219, 0.3); /* gray-300 with opacity */
        padding: 0.1rem 0.3rem;
        border-radius: 0.25rem;
      }
      pre code {
        /* Don't style code inside pre differently */
        background-color: transparent;
        padding: 0;
        border-radius: 0;
      }
      .interactive-section {
        background-color: #ffffff; /* white */
        padding: 1.5rem; /* p-6 */
        border-radius: 0.5rem; /* rounded-lg */
        box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1),
          0 1px 2px 0 rgba(0, 0, 0, 0.06); /* shadow-md */
        margin-bottom: 1.5rem; /* mb-6 */
      }
      .btn {
        background-color: #3b82f6; /* blue-500 */
        color: white;
        padding: 0.5rem 1rem; /* py-2 px-4 */
        border-radius: 0.375rem; /* rounded-md */
        font-weight: 500; /* font-medium */
        cursor: pointer;
        transition: background-color 0.2s ease;
        border: none;
        margin-right: 0.5rem; /* mr-2 */
        margin-top: 0.5rem; /* Add some top margin for buttons */
      }
      .btn:hover:not(:disabled) {
        background-color: #2563eb; /* blue-600 */
      }
      .btn:disabled {
        background-color: #9ca3af; /* gray-400 */
        cursor: not-allowed;
      }
      .btn-green {
        background-color: #22c55e; /* green-500 */
      }
      .btn-green:hover:not(:disabled) {
        background-color: #16a34a; /* green-600 */
      }
      .input-field,
      .select-field {
        border: 1px solid #d1d5db; /* gray-300 */
        padding: 0.5rem; /* p-2 */
        border-radius: 0.375rem; /* rounded-md */
        margin-right: 0.5rem; /* mr-2 */
        margin-top: 0.25rem; /* mt-1 */
        margin-bottom: 0.5rem; /* mb-2 */
      }
      .message-box {
        margin-top: 1rem; /* mt-4 */
        padding: 0.75rem; /* p-3 */
        border-radius: 0.375rem; /* rounded-md */
        font-size: 0.875rem; /* text-sm */
      }
      .message-box-success {
        background-color: #dcfce7; /* green-100 */
        color: #166534; /* green-800 */
        border: 1px solid #86efac; /* green-300 */
      }
      .message-box-error {
        background-color: #fee2e2; /* red-100 */
        color: #991b1b; /* red-800 */
        border: 1px solid #fecaca; /* red-300 */
      }
      .message-box-info {
        background-color: #e0f2fe; /* sky-100 */
        color: #075985; /* sky-800 */
        border: 1px solid #bae6fd; /* sky-300 */
      }
      .output-display {
        background-color: #f9fafb; /* gray-50 */
        border: 1px dashed #d1d5db; /* gray-300 */
        padding: 1rem; /* p-4 */
        border-radius: 0.375rem; /* rounded-md */
        min-height: 100px;
        font-family: monospace;
        white-space: pre-wrap; /* Keep formatting */
        margin-top: 0.5rem; /* mt-2 */
        max-height: 400px; /* Allow more height for recursion trace */
        overflow-y: auto;
      }
      /* Styling for recursion visualization */
      .call-level {
        padding-left: var(--level, 0); /* Indentation based on level */
        margin-bottom: 2px;
        border-left: 2px solid transparent;
        padding-top: 1px;
        padding-bottom: 1px;
      }
      .call-level.calling {
        border-left-color: #fbbf24;
        background-color: #fefce8;
      } /* amber */
      .call-level.returning {
        border-left-color: #34d399;
        background-color: #f0fdfa;
      } /* emerald */
      .call-level.base-case {
        border-left-color: #a78bfa;
        background-color: #f5f3ff;
      } /* violet */
    </style>
  </head>
  <body class="bg-gray-50 text-gray-800 p-4 md:p-8">
    <header class="text-center mb-8">
      <h1 class="text-3xl md:text-4xl font-bold text-blue-600">
        Understanding Recursion
      </h1>
      <p class="text-lg text-gray-600 mt-2">
        An Interactive Guide (using Python examples)
      </p>
    </header>

    <nav
      class="max-w-4xl mx-auto mb-6 p-3 bg-white rounded-lg shadow-md flex justify-between items-center"
    >
      <a
        href="oop-advanced.html"
        class="text-blue-600 hover:text-blue-800 font-medium transition-colors duration-200"
      >
        &larr; OOP (Advanced)
      </a>
      <a
        href="index.html"
        class="text-blue-600 hover:text-blue-800 font-medium transition-colors duration-200"
      >
        Next Tutorial: Return Home &rarr;
      </a>
    </nav>

    <main class="max-w-4xl mx-auto">
      <section class="mb-8">
        <h2 class="text-2xl font-semibold text-gray-700 mb-3">
          1. What is Recursion?
        </h2>
        <p class="mb-4">
          Recursion is a programming technique where a function calls itself in
          order to solve a problem. Instead of using loops (like
          <code>for</code> or <code>while</code>) to repeat steps, a recursive
          function breaks the problem down into smaller, self-similar
          subproblems until it reaches a simple case that can be solved
          directly.
        </p>
        <p>
          Think of it like Russian nesting dolls: each doll contains a smaller
          version of itself, until you reach the smallest doll that can't be
          opened further.
        </p>
        <p class="mt-2">A recursive function typically has two main parts:</p>
        <ul class="list-disc list-inside ml-4 mt-2 space-y-1">
          <li>
            <strong>Base Case:</strong> The simplest version of the problem that
            can be solved directly, without making another recursive call. This
            stops the recursion.
          </li>
          <li>
            <strong>Recursive Step:</strong> The part where the function calls
            itself with modified arguments, moving closer to the base case.
          </li>
        </ul>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-semibold text-gray-700 mb-3">
          2. Base Case and Recursive Step: The Factorial Example
        </h2>
        <p class="mb-2">
          Calculating the factorial of a non-negative integer `n` (denoted as
          `n!`) is a classic example.
          <code>n! = n * (n-1) * (n-2) * ... * 1</code>. For example,
          <code>5! = 5 * 4 * 3 * 2 * 1 = 120</code>. Also, <code>0!</code> is
          defined as 1.
        </p>
        <p class="mb-2">We can define factorial recursively:</p>
        <ul class="list-disc list-inside ml-4 space-y-1">
          <li>
            <strong>Base Case:</strong> If <code>n</code> is 0, the factorial is
            1. (<code>factorial(0) = 1</code>)
          </li>
          <li>
            <strong>Recursive Step:</strong> If <code>n</code> is greater than
            0, the factorial is <code>n</code> multiplied by the factorial of
            <code>n-1</code>. (<code>factorial(n) = n * factorial(n-1)</code>)
          </li>
        </ul>
        <pre><code class="language-python">def factorial(n):
  # Base Case: Stop the recursion
  if n == 0:
    print(f"Base case reached: factorial(0) returns 1")
    return 1
  # Recursive Step: Call the function with a smaller value
  else:
    print(f"Calculating factorial({n})... Needs factorial({n-1})")
    recursive_result = factorial(n - 1) # Function calls itself
    result = n * recursive_result
    print(f"Returning from factorial({n}): {n} * {recursive_result} = {result}")
    return result

# Example call
print("Calculating 3!:")
final_answer = factorial(3)
print(f"\nFinal Answer for 3!: {final_answer}") # Output: 6</code></pre>
        <p class="mt-2 text-red-600 font-medium">
          <strong>Crucial:</strong> Without a base case, a recursive function
          would call itself infinitely, leading to a "stack overflow" error.
        </p>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-semibold text-gray-700 mb-3">
          3. How Recursion Works: The Call Stack
        </h2>
        <p class="mb-4">
          When a function calls another function (or itself), the system uses a
          structure called the <strong>call stack</strong> to keep track of
          where it is. Each time a function is called, a new "frame" is added to
          the top of the stack, containing information about that specific call
          (like its local variables).
        </p>
        <p class="mb-2">In recursion:</p>
        <ul class="list-disc list-inside ml-4 space-y-1">
          <li>
            Each recursive call adds a new frame to the stack (e.g.,
            <code>factorial(3)</code> calls <code>factorial(2)</code>, which
            calls <code>factorial(1)</code>, etc.).
          </li>
          <li>
            When a function reaches its base case and returns a value, its frame
            is removed (popped) from the stack.
          </li>
          <li>
            The returned value is passed back to the function call that was
            waiting for it (the frame below it on the stack).
          </li>
          <li>
            This "unwinding" process continues until the original function call
            receives its result and its frame is popped off the stack.
          </li>
        </ul>
        <p class="mt-2">
          Visualizing this stack helps understand how recursion progresses and
          eventually terminates.
        </p>
      </section>

      <section class="mb-8 interactive-section">
        <h2 class="text-2xl font-semibold text-gray-700 mb-3">
          4. Visualize Recursion: Factorial
        </h2>
        <p class="mb-4">
          Enter a small non-negative integer (e.g., 3, 4, 5) to see a
          step-by-step simulation of the recursive factorial calculation.
          Observe the calls going deeper and the results returning back up.
        </p>
        <div class="mb-4">
          <h4 class="text-md font-medium mb-1">Function Definition:</h4>
          <pre><code class="language-python">
def factorial(n):
  if n == 0: # Base Case
    return 1
  else:      # Recursive Step
    return n * factorial(n - 1)
                </code></pre>
        </div>

        <div class="flex flex-wrap items-center mb-2">
          <label for="factorialInput" class="mr-2"
            >Calculate Factorial of:</label
          >
          <input
            type="number"
            id="factorialInput"
            class="input-field input-field-small"
            placeholder="e.g., 4"
            value="4"
            min="0"
            max="15"
          />
          <button id="runFactorialButton" class="btn btn-green">
            Run Simulation
          </button>
        </div>

        <h4 class="text-md font-medium mt-3 mb-1">
          Execution Trace (Simulated Call Stack):
        </h4>
        <div id="recursionLogDisplay" class="output-display">
          <span class="text-gray-500 italic"
            >Enter a number and click 'Run Simulation'.</span
          >
        </div>

        <div
          id="recursionMessage"
          class="message-box"
          style="display: none"
        ></div>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-semibold text-gray-700 mb-3">
          5. Pros and Cons of Recursion
        </h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-medium text-green-600">Pros:</h3>
            <ul class="list-disc list-inside mt-1 space-y-1">
              <li>
                Can lead to elegant, simple code for problems that are naturally
                recursive (e.g., tree traversals, some mathematical functions).
              </li>
              <li>
                Reduces the need for complex loop management in some cases.
              </li>
              <li>
                Can make code easier to read and understand *if* the problem
                fits the recursive pattern well.
              </li>
            </ul>
          </div>
          <div>
            <h3 class="text-lg font-medium text-red-600">Cons:</h3>
            <ul class="list-disc list-inside mt-1 space-y-1">
              <li>
                Can be less efficient than iterative solutions due to the
                overhead of function calls (call stack management).
              </li>
              <li>
                Can lead to stack overflow errors if the recursion goes too deep
                (exceeds the maximum stack depth).
              </li>
              <li>
                Can sometimes be harder to debug and trace compared to loops.
              </li>
              <li>Not all problems are well-suited for recursion.</li>
            </ul>
          </div>
        </div>
      </section>

      <section class="mb-8 interactive-section">
        <h2 class="text-2xl font-semibold text-gray-700 mb-3">6. Quick Quiz</h2>
        <p class="mb-4">Test your understanding!</p>
        <div class="mb-3">
          <p class="font-medium mb-1">Q1: What defines a recursive function?</p>
          <label class="block"
            ><input type="radio" name="q1_recur" value="a" class="mr-1" /> It
            uses a `for` loop</label
          >
          <label class="block"
            ><input type="radio" name="q1_recur" value="b" class="mr-1" /> It
            calls itself</label
          >
          <label class="block"
            ><input type="radio" name="q1_recur" value="c" class="mr-1" /> It
            handles errors with `try...except`</label
          >
        </div>
        <div class="mb-3">
          <p class="font-medium mb-1">
            Q2: What is the purpose of a "base case" in recursion?
          </p>
          <label class="block"
            ><input type="radio" name="q2_recur" value="a" class="mr-1" /> To
            make the function call itself</label
          >
          <label class="block"
            ><input type="radio" name="q2_recur" value="b" class="mr-1" /> To
            handle errors</label
          >
          <label class="block"
            ><input type="radio" name="q2_recur" value="c" class="mr-1" /> To
            stop the recursion and provide a direct answer</label
          >
        </div>
        <div class="mb-3">
          <p class="font-medium mb-1">
            Q3: What happens if a recursive function has no base case (or it's
            never reached)?
          </p>
          <label class="block"
            ><input type="radio" name="q3_recur" value="a" class="mr-1" /> The
            function returns `None`</label
          >
          <label class="block"
            ><input type="radio" name="q3_recur" value="b" class="mr-1" /> It
            runs infinitely (or until a stack overflow error)</label
          >
          <label class="block"
            ><input type="radio" name="q3_recur" value="c" class="mr-1" /> It
            automatically stops after 100 calls</label
          >
        </div>
        <div class="mb-3">
          <p class="font-medium mb-1">
            Q4: Which data structure does the system use internally to manage
            function calls, including recursive ones?
          </p>
          <label class="block"
            ><input type="radio" name="q4_recur" value="a" class="mr-1" />
            Queue</label
          >
          <label class="block"
            ><input type="radio" name="q4_recur" value="b" class="mr-1" />
            List</label
          >
          <label class="block"
            ><input type="radio" name="q4_recur" value="c" class="mr-1" /> Call
            Stack</label
          >
        </div>
        <button id="checkQuizButtonRecur" class="btn">Check Answers</button>
        <div
          id="quizResultRecur"
          class="message-box mt-4"
          style="display: none"
        ></div>
      </section>
    </main>

    <footer class="text-center mt-12 text-gray-500 text-sm">
      <p>Happy Learning!</p>
    </footer>

    <script>
      // --- Shared Utility Functions ---
      function showMessage(element, message, type = "info") {
        element.textContent = message;
        element.className = `message-box message-box-${type}`;
        element.style.display = "block";
        setTimeout(() => {
          element.style.display = "none";
        }, 3000);
      }

      // --- DOM Elements ---
      const factorialInput = document.getElementById("factorialInput");
      const runFactorialButton = document.getElementById("runFactorialButton");
      const recursionLogDisplay = document.getElementById(
        "recursionLogDisplay"
      );
      const recursionMessage = document.getElementById("recursionMessage");

      const checkQuizButtonRecur = document.getElementById(
        "checkQuizButtonRecur"
      );
      const quizResultRecur = document.getElementById("quizResultRecur");

      // --- Recursion Simulation Logic ---
      let simulationTimeout = null; // To cancel ongoing simulation if needed

      // Function to simulate factorial and log steps
      async function simulateFactorial(n, level = 0) {
        const indent = "&nbsp;".repeat(level * 2); // Indentation for visualization
        const logDiv = (message, className = "") => {
          const entry = document.createElement("div");
          entry.className = `call-level ${className}`;
          entry.style.setProperty("--level", `${level * 10}px`); // Control CSS variable for indent
          entry.innerHTML = indent + message;
          recursionLogDisplay.appendChild(entry);
          recursionLogDisplay.scrollTop = recursionLogDisplay.scrollHeight;
        };

        // Log the function call
        logDiv(`-> Calling factorial(${n})`, "calling");
        await new Promise((resolve) => setTimeout(resolve, 400)); // Delay

        // Base Case
        if (n === 0) {
          logDiv(`   Base case (n=0), returning 1`, "base-case");
          await new Promise((resolve) => setTimeout(resolve, 400));
          return 1;
        }
        // Recursive Step
        else {
          logDiv(`   Needs factorial(${n - 1})...`, "calling");
          await new Promise((resolve) => setTimeout(resolve, 400));

          const recursiveResult = await simulateFactorial(n - 1, level + 1); // Recursive call

          const result = n * recursiveResult;
          logDiv(
            `<- Returning from factorial(${n}): ${n} * ${recursiveResult} = ${result}`,
            "returning"
          );
          await new Promise((resolve) => setTimeout(resolve, 400));
          return result;
        }
      }

      runFactorialButton.addEventListener("click", async () => {
        // Cancel any previous simulation
        if (simulationTimeout) {
          clearTimeout(simulationTimeout);
          simulationTimeout = null;
        }
        runFactorialButton.disabled = true;
        recursionLogDisplay.innerHTML = ""; // Clear previous log

        const nStr = factorialInput.value;
        const n = parseInt(nStr, 10);

        if (isNaN(n) || n < 0 || !Number.isInteger(n)) {
          recursionLogDisplay.innerHTML =
            '<span class="text-red-500">Error: Please enter a non-negative integer.</span>';
          showMessage(recursionMessage, "Invalid input.", "error");
          runFactorialButton.disabled = false;
          return;
        }
        if (n > 15) {
          // Limit to prevent browser slowdown/too much output
          recursionLogDisplay.innerHTML =
            '<span class="text-orange-500">Input is large, limiting to 15 for visualization.</span>';
          showMessage(
            recursionMessage,
            "Input too large, limited to 15.",
            "info"
          );
          // n = 15; // Optionally cap the value
          // factorialInput.value = 15;
          // For now, just show message and don't run
          runFactorialButton.disabled = false;
          return;
        }

        showMessage(recursionMessage, `Simulating factorial(${n})...`, "info");

        try {
          const finalResult = await simulateFactorial(n);
          const finalMsg = document.createElement("div");
          finalMsg.innerHTML = `\n<strong>Final Result for factorial(${n}): ${finalResult}</strong>`;
          recursionLogDisplay.appendChild(finalMsg);
          recursionLogDisplay.scrollTop = recursionLogDisplay.scrollHeight;
          showMessage(recursionMessage, "Simulation complete.", "success");
        } catch (e) {
          // Should not happen with input validation, but good practice
          recursionLogDisplay.innerHTML += `<span class="text-red-500">\nSimulation Error: ${e.message}</span>`;
          showMessage(
            recursionMessage,
            "An error occurred during simulation.",
            "error"
          );
        } finally {
          runFactorialButton.disabled = false;
        }
      });

      // --- Quiz Logic ---
      function checkRecursionQuiz() {
        const answers = {
          q1_recur: "b", // Calls itself
          q2_recur: "c", // Stop recursion / direct answer
          q3_recur: "b", // Infinite loop / stack overflow
          q4_recur: "c", // Call Stack
        };
        let score = 0;
        let resultsHTML = "<ul>";
        let allAnswered = true;

        for (const q in answers) {
          const selected = document.querySelector(`input[name="${q}"]:checked`);
          if (!selected) {
            allAnswered = false;
            break;
          }
          const isCorrect = selected.value === answers[q];
          if (isCorrect) {
            score++;
            resultsHTML += `<li class="text-green-700">✓ Question ${q.substring(
              1,
              2
            )}: Correct!</li>`;
          } else {
            resultsHTML += `<li class="text-red-700">✗ Question ${q.substring(
              1,
              2
            )}: Incorrect.</li>`;
          }
        }

        if (!allAnswered) {
          quizResultRecur.textContent =
            "Please answer all questions before checking.";
          quizResultRecur.className = "message-box message-box-error";
          quizResultRecur.style.display = "block";
          return;
        }

        resultsHTML += "</ul>";
        resultsHTML =
          `<p class="font-medium mb-2">You scored ${score} out of ${
            Object.keys(answers).length
          }.</p>` + resultsHTML;

        quizResultRecur.innerHTML = resultsHTML;
        quizResultRecur.className =
          score === Object.keys(answers).length
            ? "message-box message-box-success"
            : "message-box message-box-error";
        quizResultRecur.style.display = "block";
      }

      // --- Event Listeners ---
      checkQuizButtonRecur.addEventListener("click", checkRecursionQuiz);

      // --- Initial Setup ---
      window.onload = () => {
        // No specific setup needed initially
      };
    </script>
  </body>
</html>
