<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Error Handling - Python Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/shared-styles.css">
  </head>
  <body class="min-h-screen">
    <div class="console-screen-border">
      <nav class="navbar-8bit mb-6">
        <a href="functions.html" class="btn-8bit">&larr; Functions</a>
        <a href="../index.html" class="btn-8bit">Main Menu</a>
        <a href="file-handling.html" class="btn-8bit">File Handling &rarr;</a>
      </nav>

      <div class="content-wrapper-8bit">
        <h1 class="page-title-8bit mb-6">
          Error Handling: Try/Except
        </h1>

        <section class="interactive-section mb-6">
          <h2 class="text-xl font-semibold mb-3">
            1. What are Errors?
          </h2>
          <p class="mb-4">
            Errors stop programs unexpectedly. Two types:
          </p>
          <ul class="list-disc list-inside ml-4 space-y-1">
            <li><strong>Syntax Errors:</strong> Code structure problems (typos, missing colons). Python catches these before running.</li>
            <li><strong>Exceptions:</strong> Errors during program execution (e.g., <code>ZeroDivisionError</code>, <code>IndexError</code>, <code>ValueError</code>).</li>
          </ul>
          <p class="mt-2">
            We handle <strong>Exceptions</strong> with <code>try...except</code>.
          </p>
        </section>

        <section class="interactive-section mb-6">
          <h2 class="text-xl font-semibold mb-3">
            2. Basic `try` and `except`
          </h2>
          <p class="mb-2">
            Code that might cause an error goes in <code>try</code>. If an error occurs, Python jumps to <code>except</code>. If no error, <code>except</code> is skipped.
          </p>
          <pre><code class="language-python">try:
  # Risky code: dividing by user input
  value = int(input("Enter a number to divide 10 by: "))
  result = 10 / value
  print(f"10 / {value} = {result}")
except:
  print("Oops! A glitch in the matrix (an error occurred).")

print("Program continues...")</code></pre>
        </section>

        <section class="interactive-section mb-6">
          <h2 class="text-xl font-semibold mb-3">
            3. Handling Specific Exceptions
          </h2>
          <p class="mb-2">
            Catch specific exceptions for tailored responses. Multiple <code>except</code> blocks can be used.
          </p>
          <pre><code class="language-python">try:
  item_level_str = input("Enter item level (1-100): ")
  level = int(item_level_str) # Potential ValueError
  power = 1000 / level      # Potential ZeroDivisionError (if level 0 allowed)
  print(f"Item power at level {level}: {power}")
except ValueError:
  print(f"Invalid level: '{item_level_str}' is not a number.")
except ZeroDivisionError:
  print("Error: Level cannot be zero for power calculation!")
except Exception as e: # Catch any other unexpected errors
  print(f"An unknown enchantment failed: {e}")

print("Forge continues its work...")</code></pre>
        </section>

        <section class="interactive-section mb-6">
          <h2 class="text-xl font-semibold mb-3">
            4. `else` and `finally` Clauses
          </h2>
          <p class="mb-2"><strong><code>else</code> Clause:</strong> Runs if NO exceptions occurred in <code>try</code>.</p>
          <p class="mb-2"><strong><code>finally</code> Clause:</strong> ALWAYS runs, exception or not. Good for cleanup (e.g., closing files/connections).
          </p>
          <pre><code class="language-python">ancient_scroll = None
try:
  scroll_name = "scroll_of_wisdom.txt"
  # ancient_scroll = open(scroll_name, "r") # This would be real file IO
  print(f"Attempting to read '{scroll_name}'...")
  # content = ancient_scroll.read() # Simulate reading
  # print(f"Scroll says: {content}") 
  # For demo, let's assume it can succeed or fail randomly
  if input("Does reading the scroll succeed? (yes/no): ").lower() != "yes":
      raise ValueError("The runes are illegible!")
except FileNotFoundError: # Example if open() was real
  print(f"Error: Scroll '{scroll_name}' not found in library.")
except ValueError as ve:
  print(f"ValueError: {ve}")
else:
  print("Scroll deciphered successfully! No errors in try block.")
finally:
  # if ancient_scroll: ancient_scroll.close()
  print("The scholar leaves the library (finally block executed).")

print("The day ends.")</code></pre>
        </section>

        <section class="interactive-section mb-6">
          <h2 class="text-xl font-semibold mb-3">Interactive Potion Brewing</h2>
          <p class="mb-2">
            Try to brew a potion. Enter ingredients and see if it succeeds or if an error (exception) occurs!
          </p>
          <div class="sub-interactive-box">
            <label for="ingredient1Input" class="block mb-1 font-semibold">Ingredient 1 (e.g., 'Dragon Scale', 'number'):</label>
            <input type="text" id="ingredient1Input" class="input-field w-full mb-2" value="Dragon Scale">
            
            <label for="ingredient2Input" class="block mb-1 font-semibold">Ingredient 2 (e.g., 'number', 'Phoenix Tear'):</label>
            <input type="text" id="ingredient2Input" class="input-field w-full mb-2" value="10">
            
            <button id="brewPotionButton" class="btn btn-8bit">Brew Potion</button>
            
            <div id="potionResult" class="output-display min-h-[50px] mt-2">
              <span class="placeholder-text">Potion results will appear here...</span>
            </div>
             <div id="errorHandlingMessage" class="message-box mt-3" style="display: none;"></div>
          </div>
        </section>

      </div> <!-- End of content-wrapper-8bit -->
    </div> <!-- End of console-screen-border -->

    <script>
      const ingredient1Input = document.getElementById('ingredient1Input');
      const ingredient2Input = document.getElementById('ingredient2Input');
      const brewPotionButton = document.getElementById('brewPotionButton');
      const potionResultDiv = document.getElementById('potionResult');
      const messageBox = document.getElementById('errorHandlingMessage');

      function showBrewMessage(msg, type = 'info') {
        messageBox.textContent = msg;
        messageBox.className = `message-box message-box-${type}`;
        messageBox.style.display = 'block';
        setTimeout(() => { messageBox.style.display = 'none'; }, 3000);
      }

      brewPotionButton.addEventListener('click', () => {
        const ing1 = ingredient1Input.value;
        const ing2 = ingredient2Input.value;
        let potionLog = "Starting to brew...\n";

        try {
          potionLog += `Adding '${ing1}' to the cauldron.\n`;
          
          // Simulate potential errors
          if (ing1.toLowerCase() === 'number' || ing2.toLowerCase() === 'number') {
            // Try to convert second ingredient to a number, if first is 'number'
            // or if second one is explicitly 'number'. This is a common source of ValueError.
            let quantity = 0;
            if (ing1.toLowerCase() === 'number'){
                potionLog += "Expecting second ingredient to be a quantity (number).\n";
                quantity = parseInt(ing2); 
                 if (isNaN(quantity)) {
                    throw new Error('ValueError_Num: Second ingredient is not a valid number for quantity.');
                }
            } else if (ing2.toLowerCase() === 'number') {
                 potionLog += "Expecting first ingredient to be a quantity (number).\n";
                quantity = parseInt(ing1); 
                 if (isNaN(quantity)) {
                    throw new Error('ValueError_Num: First ingredient is not a valid number for quantity.');
                }
            } else {
                quantity = 1; // Default quantity if not expecting a number
            }
            
            potionLog += `Successfully added quantity: ${quantity}.\n`;
          }

          if (ing1.toLowerCase() === 'dragon scale' && parseInt(ing2) === 0) {
            throw new Error('ZeroDivisionError_Sim: Cannot divide by zero scales! Potion unstable.');
          }
          
          if (ing1.toLowerCase() === 'griffin feather' && ing2.toLowerCase() === 'lead') {
              throw new Error('TypeError_Sim: Cannot mix feathers with heavy metals! Alchemy fail.');
          }

          // Success
          potionLog += `Successfully brewed a Potion of 8-Bit Wonder with '${ing1}' and '${ing2}'!\n`;
          potionResultDiv.innerHTML = potionLog.replace(/\n/g, "<br>");
          showBrewMessage('Potion brewed successfully!', 'success');

        } catch (error) {
          potionLog += `Error during brewing: ${error.message}\n`;
          if (error.message.startsWith('ValueError_Num')) {
            potionLog += "Hint: Ensure numeric ingredients are valid numbers.\n";
             showBrewMessage('Invalid number for ingredient quantity!', 'error');
          } else if (error.message.startsWith('ZeroDivisionError_Sim')) {
            potionLog += "Hint: Dragon scales are potent, don't use zero!\n";
            showBrewMessage('Potion unstable due to zero quantity!', 'error');
          } else if (error.message.startsWith('TypeError_Sim')) {
            potionLog += "Hint: Some ingredients just don\'t mix!\n";
            showBrewMessage('Ingredient mismatch! Alchemy explosion!', 'error');
          } else {
             showBrewMessage('An unexpected brewing error occurred!', 'error');
          }
          potionResultDiv.innerHTML = potionLog.replace(/\n/g, "<br>");
        } finally {
          potionLog += "Cleaning the cauldron (finally block executed).\n";
          // Update one last time to include finally message if not already error-outed
          if (!potionResultDiv.innerHTML.includes("Cleaning the cauldron")){
             potionResultDiv.innerHTML = potionLog.replace(/\n/g, "<br>");
          }
        }
      });
    </script>
  </body>
</html>
