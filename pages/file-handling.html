<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Learn File Handling in Python</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../css/shared-styles.css">
  </head>
  <body class="bg-blue-700 text-gray-300 p-4 md:p-8">
    <header class="text-center mb-8">
      <a href="../index.html" class="text-3xl md:text-4xl font-bold text-yellow-300 hover:text-yellow-200 transition-colors duration-200">
        Interactive Guide to Python
      </a>
      <h1 class="text-2xl md:text-3xl font-semibold text-yellow-400 mt-2">
        Understanding File Handling in Python
      </h1>
      <p class="text-xs text-cyan-500 mt-1 italic">
        Reading from and writing to files to persistently store and retrieve data.
      </p>
    </header>

    <nav
      class="max-w-4xl mx-auto mb-6 p-3 bg-blue-800 rounded-lg shadow-md flex justify-between items-center"
    >
      <a
        href="error-handling.html"
        class="bg-red-500 hover:bg-red-700 text-white font-bold py-2 px-4 rounded transition-colors duration-200"
      >
        &larr; Previous: Error Handling
      </a>
      <a
        href="random-module.html"
        class="bg-green-500 hover:bg-green-700 text-white font-bold py-2 px-4 rounded transition-colors duration-200"
      >
        Next: Random Module &rarr;
      </a>
    </nav>

    <main class="max-w-4xl mx-auto">
      <section class="mb-8">
        <h2 class="text-2xl font-semibold text-yellow-300 mb-3">
          1. Why File Handling?
        </h2>
        <p class="mb-4">
          Programs often need to read data from files (like configuration files,
          user data, input datasets) or write data to files (like logs, results,
          saved progress). File handling allows your Python programs to interact
          with the computer's file system to store and retrieve data
          persistently, meaning the data remains even after the program finishes
          running.
        </p>
        <p class="text-sm text-orange-600 bg-orange-100 p-3 rounded-md">
          <strong>Note:</strong> The interactive examples on this page
          *simulate* file operations using text areas for security reasons. Web
          browsers cannot directly access your local files through simple
          HTML/JavaScript like this. The Python code shown works with real files
          on your computer when run in a Python environment.
        </p>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-semibold text-yellow-300 mb-3">
          2. Reading from Files
        </h2>
        <p class="mb-2">
          Once a file is opened in read mode (<code>'r'</code> or
          <code>'r+'</code>), you can read its contents using several methods:
        </p>
        <ul class="list-disc list-inside ml-4 space-y-1">
          <li>
            <code>.read()</code>: Reads the entire content of the file into a
            single string. Be careful with very large files.
          </li>
          <li>
            <code>.readline()</code>: Reads a single line from the file,
            including the newline character (<code>\n</code>) at the end.
            Returns an empty string at the end of the file.
          </li>
          <li>
            <code>.readlines()</code>: Reads all lines from the file and returns
            them as a list of strings, where each string is a line including the
            newline character.
          </li>
          <li>
            Iterating directly over the file object (e.g.,
            <code>for line in f:</code>): This is often the most
            memory-efficient way to read a file line by line.
          </li>
        </ul>
        <pre><code class="language-python"># Assuming 'myfile.txt' contains:
# Line 1
# Line 2

with open('myfile.txt', 'r') as f:
  # content = f.read() # Reads "Line 1\nLine 2"
  # first_line = f.readline() # Reads "Line 1\n"
  # all_lines = f.readlines() # Reads ["Line 1\n", "Line 2"]

  print("Reading line by line:")
  for line in f: # Efficient way
    print(f"  Read: {line.strip()}") # .strip() removes leading/trailing whitespace including \n</code></pre>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-semibold text-yellow-300 mb-3">
          3. Writing to Files
        </h2>
        <p class="mb-2">
          To write data, open the file in write (<code>'w'</code>) or append
          (<code>'a'</code>) mode.
        </p>
        <ul class="list-disc list-inside ml-4 space-y-1">
          <li>
            <code>.write(string)</code>: Writes the given string to the file. It
            does *not* automatically add a newline character, so you often need
            to add <code>\n</code> manually if you want lines separated.
          </li>
          <li>
            <code>.writelines(list_of_strings)</code>: Writes each string from
            the list to the file. Like <code>.write()</code>, it does *not* add
            newline characters automatically.
          </li>
        </ul>
        <pre><code class="language-python"># Using 'w' mode (overwrites existing file or creates new)
with open('output.txt', 'w') as f:
  f.write("This is the first line.\n") # Add newline manually
  f.write("This is the second line.")

# Using 'a' mode (appends to existing file or creates new)
with open('output.txt', 'a') as f:
  f.write("\nThis line is appended.") # Add newline before appending</code></pre>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-semibold text-yellow-300 mb-3">
          4. Appending to Files
        </h2>
        <p class="mb-2">
          Appending data to a file is useful for adding new information without
          overwriting existing content.
        </p>
        <pre><code class="language-python"># Using 'a' mode (appends to existing file or creates new)
with open('output.txt', 'a') as f:
  f.write("\nThis line is appended.") # Add newline before appending</code></pre>
      </section>

      <section class="mb-8">
        <h2 class="text-2xl font-semibold text-yellow-300 mb-3">
          5. The <code>with</code> Statement (Best Practice)
        </h2>
        <p class="mb-2">
          Manually calling <code>.close()</code> can be error-prone (e.g., if an
          exception occurs before <code>.close()</code> is reached). The
          recommended way to work with files in Python is using the
          <code>with</code> statement.
        </p>
        <p class="mb-2">
          The <code>with</code> statement automatically takes care of closing
          the file, even if errors occur within the block.
        </p>
        <pre><code class="language-python"># Recommended way to open and work with files
with open('example.txt', 'r') as f:
  # File is open within this indented block
  content = f.read()
  print("Reading content inside 'with' block...")
  # print(content) # Process the content

# File is automatically closed here, outside the 'with' block
print("File is now automatically closed.")</code></pre>
        <p class="mt-2">
          <strong
            >Always prefer using the <code>with</code> statement for file
            operations.</strong
          >
        </p>
      </section>

      <section class="interactive-section mb-8">
        <h2 class="text-2xl font-semibold text-yellow-300 mb-3">
          Interactive File Operations
        </h2>
        <p class="mb-4">
          Simulate reading from and writing to a file using the text areas
          below. Remember, this doesn't affect your actual computer files.
        </p>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <h3 class="text-lg font-medium mb-2">Read Simulation</h3>
            <div class="file-sim mb-4">
              <label class="file-sim-label"
                >Simulated File Content ('sim_read.txt'):</label
              >
              <textarea
                id="readFileContent"
                class="textarea-field bg-gray-100"
                rows="5"
                readonly
              >
Line 1: Hello from the simulated file!
Line 2: This is the second line.
Line 3: End of file.</textarea
              >
            </div>
            <button id="readAllButton" class="btn">Read All (.read)</button>
            <button id="readLineButton" class="btn">
              Read Line (.readline)
            </button>
            <button id="readLinesButton" class="btn">
              Read Lines (.readlines)
            </button>
            <button id="readIterButton" class="btn">Iterate Lines</button>
            <button id="resetReadButton" class="btn btn-orange">
              Reset Read
            </button>
            <h4 class="text-md font-medium mt-3 mb-1">Read Output:</h4>
            <div id="readOutputDisplay" class="output-display">
              <span class="text-gray-500 italic">Click a read button.</span>
            </div>
          </div>

          <div>
            <h3 class="text-lg font-medium mb-2">Write Simulation</h3>
            <div class="file-sim mb-4">
              <label class="file-sim-label"
                >Simulated File ('sim_write.txt'):</label
              >
              <textarea
                id="writeFileContent"
                class="textarea-field bg-gray-100"
                rows="5"
                readonly
              ></textarea>
            </div>
            <div class="mb-2">
              <label for="writeTextInput" class="block font-medium"
                >Text to Write:</label
              >
              <input
                type="text"
                id="writeTextInput"
                class="input-field w-full"
                placeholder="Enter text here..."
              />
            </div>
            <div class="mb-2">
              <label for="writeModeSelect" class="mr-2">Mode:</label>
              <select id="writeModeSelect" class="select-field">
                <option value="w">Write ('w') - Overwrite</option>
                <option value="a">Append ('a') - Add to end</option>
              </select>
            </div>
            <div class="flex items-center mb-2">
              <button id="writeToFileButton" class="btn btn-green">
                Write to File
              </button>
              <button id="clearWriteFileButton" class="btn btn-orange">
                Clear File
              </button>
            </div>

            <h4 class="text-md font-medium mt-3 mb-1">Write Log:</h4>
            <div id="writeLogDisplay" class="output-display">
              <span class="text-gray-500 italic"
                >Enter text and click 'Write'.</span
              >
            </div>
          </div>
        </div>
        <div id="fileMessage" class="message-box" style="display: none"></div>
      </section>

      <section class="mb-8 interactive-section">
        <h2 class="text-2xl font-semibold text-yellow-300 mb-3">7. Quick Quiz</h2>
        <p class="mb-4">Test your understanding!</p>
        <div class="mb-3">
          <p class="font-medium mb-1">
            Q1: Which mode is used to open a file for writing, creating it if it
            doesn't exist and emptying it if it does?
          </p>
          <label class="block"
            ><input type="radio" name="q1_file" value="a" class="mr-1" />
            <code>'r'</code></label
          >
          <label class="block"
            ><input type="radio" name="q1_file" value="b" class="mr-1" />
            <code>'a'</code></label
          >
          <label class="block"
            ><input type="radio" name="q1_file" value="c" class="mr-1" />
            <code>'w'</code></label
          >
        </div>
        <div class="mb-3">
          <p class="font-medium mb-1">
            Q2: What is the main advantage of using `with open(...)`?
          </p>
          <label class="block"
            ><input type="radio" name="q2_file" value="a" class="mr-1" /> It
            reads the file faster</label
          >
          <label class="block"
            ><input type="radio" name="q2_file" value="b" class="mr-1" /> It
            automatically closes the file</label
          >
          <label class="block"
            ><input type="radio" name="q2_file" value="c" class="mr-1" /> It
            prevents all file-related errors</label
          >
        </div>
        <div class="mb-3">
          <p class="font-medium mb-1">
            Q3: Which method reads the entire content of a file into a single
            string?
          </p>
          <label class="block"
            ><input type="radio" name="q3_file" value="a" class="mr-1" />
            <code>.readline()</code></label
          >
          <label class="block"
            ><input type="radio" name="q3_file" value="b" class="mr-1" />
            <code>.readlines()</code></label
          >
          <label class="block"
            ><input type="radio" name="q3_file" value="c" class="mr-1" />
            <code>.read()</code></label
          >
        </div>
        <div class="mb-3">
          <p class="font-medium mb-1">
            Q4: If you open a file in `'a'` mode and write to it, where will the
            new content be added?
          </p>
          <label class="block"
            ><input type="radio" name="q4_file" value="a" class="mr-1" /> At the
            beginning of the file</label
          >
          <label class="block"
            ><input type="radio" name="q4_file" value="b" class="mr-1" /> At the
            end of the file</label
          >
          <label class="block"
            ><input type="radio" name="q4_file" value="c" class="mr-1" /> It
            will overwrite the existing content</label
          >
        </div>
        <button id="checkQuizButtonFile" class="btn">Check Answers</button>
        <div
          id="quizResultFile"
          class="message-box mt-4"
          style="display: none"
        ></div>
      </section>
    </main>

    <footer class="text-center mt-12 py-6 border-t border-yellow-500">
      <p class="text-sm text-cyan-300">Happy Coding!</p>
      <p class="mt-2">
        <a
          href="../index.html"
          class="text-yellow-400 hover:text-yellow-200 font-medium transition-colors duration-200"
          >Back to Main Menu</a
        >
      </p>
    </footer>

    <script src="../js/main.js" defer></script>
    <script>
      // showMessage is now in js/main.js

      // --- DOM Elements ---
      const readFileContent = document.getElementById("readFileContent");
      const readAllButton = document.getElementById("readAllButton");
      const readLineButton = document.getElementById("readLineButton");
      const readLinesButton = document.getElementById("readLinesButton");
      const readIterButton = document.getElementById("readIterButton");
      const resetReadButton = document.getElementById("resetReadButton");
      const readOutputDisplay = document.getElementById("readOutputDisplay");

      const writeFileContent = document.getElementById("writeFileContent");
      const writeTextInput = document.getElementById("writeTextInput");
      const writeModeSelect = document.getElementById("writeModeSelect");
      const writeToFileButton = document.getElementById("writeToFileButton");
      const clearWriteFileButton = document.getElementById(
        "clearWriteFileButton"
      );
      const writeLogDisplay = document.getElementById("writeLogDisplay");

      const fileMessage = document.getElementById("fileMessage"); // Shared message box

      const checkQuizButtonFile = document.getElementById(
        "checkQuizButtonFile"
      );
      const quizResultFile = document.getElementById("quizResultFile");

      // --- State for Read Simulation ---
      let readPointer = 0; // Simulates the file read cursor position
      const originalReadFileContent = readFileContent.value; // Store initial content

      // --- Read Simulation Logic ---
      function resetReadSimulation() {
        readPointer = 0;
        readFileContent.value = originalReadFileContent; // Restore original content if needed
        readOutputDisplay.innerHTML =
          '<span class="text-gray-500 italic">Read simulation reset.</span>';
        showMessage(fileMessage, "Read simulation reset.", "info");
      }

      readAllButton.addEventListener("click", () => {
        const content = readFileContent.value;
        readOutputDisplay.textContent = `--- Read All ---\n"${content}"`;
        readPointer = content.length; // Move pointer to end
        showMessage(fileMessage, "Simulated .read()", "success");
      });

      readLineButton.addEventListener("click", () => {
        const content = readFileContent.value;
        const remainingContent = content.substring(readPointer);
        const newlineIndex = remainingContent.indexOf("\n");
        let line;

        if (remainingContent === "") {
          line = ""; // End of file
          readOutputDisplay.textContent = `--- Read Line ---\n(End Of File Reached)`;
        } else if (newlineIndex !== -1) {
          line = remainingContent.substring(0, newlineIndex + 1); // Include newline
          readPointer += line.length;
          readOutputDisplay.textContent = `--- Read Line ---\n"${line}"`;
        } else {
          line = remainingContent; // Last line without newline
          readPointer = content.length;
          readOutputDisplay.textContent = `--- Read Line ---\n"${line}"`;
        }
        showMessage(fileMessage, "Simulated .readline()", "success");
      });

      readLinesButton.addEventListener("click", () => {
        const content = readFileContent.value;
        const lines = content.split("\n").map((line, index, arr) => {
          // Add back newline except for the very last line if file doesn't end with one
          return index < arr.length - 1 || content.endsWith("\n")
            ? line + "\n"
            : line;
        });
        // Handle case where file is empty or only has empty lines correctly
        if (content === "") {
          readOutputDisplay.textContent = `--- Read Lines ---\n[]`;
        } else {
          const formattedLines =
            "[" + lines.map((l) => `"${l}"`).join(", ") + "]";
          readOutputDisplay.textContent = `--- Read Lines ---\n${formattedLines}`;
        }
        readPointer = content.length; // Move pointer to end
        showMessage(fileMessage, "Simulated .readlines()", "success");
      });

      readIterButton.addEventListener("click", () => {
        const content = readFileContent.value;
        const lines = content.split("\n");
        readOutputDisplay.textContent = "--- Iterating Lines ---\n";
        lines.forEach((line) => {
          readOutputDisplay.textContent += `Read: "${line}"\n`;
        });
        readPointer = content.length; // Move pointer to end
        showMessage(
          fileMessage,
          "Simulated iteration over file object.",
          "success"
        );
      });

      resetReadButton.addEventListener("click", resetReadSimulation);

      // --- Write Simulation Logic ---
      clearWriteFileButton.addEventListener("click", () => {
        writeFileContent.value = "";
        writeLogDisplay.textContent = "Simulated file cleared.";
        showMessage(fileMessage, "Simulated file cleared.", "info");
      });

      writeToFileButton.addEventListener("click", () => {
        const textToWrite = writeTextInput.value;
        const mode = writeModeSelect.value;
        let logMessage = "";

        if (mode === "w") {
          writeFileContent.value = textToWrite; // Overwrite
          logMessage = `Mode 'w': Wrote "${textToWrite}". File content overwritten.`;
        } else {
          // mode === 'a'
          // Add newline before appending if file not empty and doesn't end with newline
          if (
            writeFileContent.value.length > 0 &&
            !writeFileContent.value.endsWith("\n")
          ) {
            writeFileContent.value += "\n";
          }
          writeFileContent.value += textToWrite; // Append
          logMessage = `Mode 'a': Appended "${textToWrite}".`;
        }

        writeLogDisplay.textContent = logMessage;
        writeTextInput.value = ""; // Clear input after writing
        showMessage(
          fileMessage,
          "Simulated write operation complete.",
          "success"
        );
      });

      // --- Quiz Logic ---
      function checkFileQuiz() {
        const answers = {
          q1_file: "c", // 'w'
          q2_file: "b", // Automatically closes
          q3_file: "c", // .read()
          q4_file: "b", // At the end
        };
        let score = 0;
        let resultsHTML = "<ul>";
        let allAnswered = true;

        for (const q in answers) {
          const selected = document.querySelector(`input[name="${q}"]:checked`);
          if (!selected) {
            allAnswered = false;
            break;
          }
          const isCorrect = selected.value === answers[q];
          if (isCorrect) {
            score++;
            resultsHTML += `<li class="text-green-700">✓ Question ${q.substring(
              1,
              2
            )}: Correct!</li>`;
          } else {
            resultsHTML += `<li class="text-red-700">✗ Question ${q.substring(
              1,
              2
            )}: Incorrect.</li>`;
          }
        }

        if (!allAnswered) {
          quizResultFile.textContent =
            "Please answer all questions before checking.";
          quizResultFile.className = "message-box message-box-error";
          quizResultFile.style.display = "block";
          return;
        }

        resultsHTML += "</ul>";
        resultsHTML =
          `<p class="font-medium mb-2">You scored ${score} out of ${
            Object.keys(answers).length
          }.</p>` + resultsHTML;

        quizResultFile.innerHTML = resultsHTML;
        quizResultFile.className =
          score === Object.keys(answers).length
            ? "message-box message-box-success"
            : "message-box message-box-error";
        quizResultFile.style.display = "block";
      }

      // --- Event Listeners ---
      checkQuizButtonFile.addEventListener("click", checkFileQuiz);

      // --- Initial Setup ---
      window.onload = () => {
        resetReadSimulation(); // Set initial read state
        // Initial write state is empty textarea
      };
    </script>
  </body>
</html>
